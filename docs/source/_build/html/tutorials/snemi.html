

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Neuron Segmentation &mdash; connectomics latest documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'latest',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Mitochondria Segmentation" href="lucchi.html" />
    <link rel="prev" title="Configurations" href="../notes/config.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo_text.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notes/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/config.html">Configurations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../notes/config.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notes/config.html#multiple-losses-for-a-single-learning-target">Multiple Losses for a Single Learning Target</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notes/config.html#multitask-learning">Multitask Learning</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Neuron Segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="lucchi.html">Mitochondria Segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="cremi.html">Synaptic Cleft Segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="synaptic_partner.html">Synaptic Partner Segmentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Package Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/model.html">connectomics.model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/model.html#building-blocks">Building Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/model.html#model-zoo">Model Zoo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/augmentation.html">connectomics.data.augmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/datasets.html">connectomics.data.datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/engine.html">connectomics.engine</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">connectomics</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Neuron Segmentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/snemi.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="neuron-segmentation">
<h1>Neuron Segmentation<a class="headerlink" href="#neuron-segmentation" title="Permalink to this headline">Â¶</a></h1>
<p>This tutorial provides step-by-step guidance for neuron segmentation with SENMI3D benchmark datasets.
Dense neuron segmentation in electronic microscopy (EM) images belongs to the category of instance segmentation.
The methodology is to first predict the affinity map (the connectivity of each pixel to neighboring pixels)
with an encoder-decoder ConvNets and then generate the segmentation map using a standard
segmentation algorithm (e.g., watershed).</p>
<p>The evaluation of segmentation results is based on the <a class="reference external" href="https://en.wikipedia.org/wiki/Rand_index">Rand Index</a>
and <a class="reference external" href="https://en.wikipedia.org/wiki/Variation_of_information">Variation of Information</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Before running neuron segmentation, please take a look at the <a class="reference external" href="https://github.com/zudi-lin/pytorch_connectomics/tree/master/demos">demos</a>
to get familiar with the datasets.</p>
</div>
<p>The main script to run the training and inference is <code class="docutils literal"><span class="pre">pytorch_connectomics/scripts/main.py</span></code>.
The pytorch target affinity generation is <code class="xref py py-class docutils literal"><span class="pre">connectomics.data.dataset.VolumeDataset</span></code>.</p>
<ol class="arabic">
<li><p class="first">Get the dataset:</p>
<blockquote>
<div><blockquote>
<div><div class="highlight-none"><div class="highlight"><pre><span></span>wget http://hp03.mindhackers.org/rhoana_product/dataset/snemi.zip
</pre></div>
</div>
</div></blockquote>
<p>For description of the data please check <a class="reference external" href="https://vcg.github.io/newbie-wiki/build/html/data/data_em.html">this page</a>.</p>
</div></blockquote>
</li>
<li><p class="first">Provide the <code class="docutils literal"><span class="pre">yaml</span></code> configuration file to run training:</p>
<blockquote>
<div><div class="highlight-none"><div class="highlight"><pre><span></span>$ source activate py3_torch
$ python scripts/main.py --config-file configs/SNEMI-Neuron.yaml
</pre></div>
</div>
<p>The configuration file for training is in <code class="docutils literal"><span class="pre">configs/SNEMI-Neuron.yaml</span></code>.
We usualy create a <code class="docutils literal"><span class="pre">datasets/</span></code> folder under <code class="docutils literal"><span class="pre">pytorch_connectomics</span></code> and put the SNEMI dataset there. Please modify the following options according to
your system configuration and data storage:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">IMAGE_NAME</span></code>: Name of the volume file (HDF5 or TIFF).</li>
<li><code class="docutils literal"><span class="pre">LABEL_NAME</span></code>: Name of the label file (HDF5 or TIFF).</li>
<li><code class="docutils literal"><span class="pre">INPUT_PATH</span></code>: Path to both files above.</li>
<li><code class="docutils literal"><span class="pre">OUTPUT_PATH</span></code>: Path to store outputs (checkpoints and Tensorboard events).</li>
<li><code class="docutils literal"><span class="pre">NUM_GPUS</span></code>: Number of GPUs to use.</li>
<li><code class="docutils literal"><span class="pre">NUM_CPUS</span></code>: Number of CPU cores to use (for data loading).</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">(Optional) To run training starting from pretrained weights, add a checkpoint file:</p>
<blockquote>
<div><div class="highlight-none"><div class="highlight"><pre><span></span>$ source activate py3_torch
$ python scripts/main.py --config-file configs/SNEMI-Neuron.yaml \
$ --checkpoint /path/to/checkpoint/checkpoint_xxxxx.pth.tar
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Visualize the training progress:</p>
<blockquote>
<div><div class="highlight-none"><div class="highlight"><pre><span></span>$ tensorboard --logdir outputs/SNEMI/
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Run inference on image volumes, The test configuration file can have bigger input, augmentation at inference:</p>
<blockquote>
<div><div class="highlight-none"><div class="highlight"><pre><span></span>$ python scripts/main.py --config-file configs/SNEMI-Neuron.yaml
--inference --checkpoint outputs/SNEMI/checkpoint_xxxxx.pth
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Generate segmentation and run evaluation:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Download the <code class="docutils literal"><span class="pre">waterz</span></code> package:</p>
<blockquote>
<div><div class="highlight-none"><div class="highlight"><pre><span></span>$ git clone git@github.com:zudi-lin/waterz.git
$ cd waterz
$ pip install --editable .
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Download the <code class="docutils literal"><span class="pre">zwatershed</span></code> package:</p>
<blockquote>
<div><div class="highlight-none"><div class="highlight"><pre><span></span>$ git clone git@github.com:zudi-lin/zwatershed.git
$ cd zwatershed
$ pip install --editable .
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Generate 3D segmentation and report Rand and VI score using <code class="docutils literal"><span class="pre">waterz</span></code>. Please see examples at <a class="reference external" href="https://github.com/zudi-lin/waterz">https://github.com/zudi-lin/waterz</a>.</p>
</li>
</ol>
</div></blockquote>
</li>
</ol>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lucchi.html" class="btn btn-neutral float-right" title="Mitochondria Segmentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../notes/config.html" class="btn btn-neutral float-left" title="Configurations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Zudi Lin and Donglai Wei

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>