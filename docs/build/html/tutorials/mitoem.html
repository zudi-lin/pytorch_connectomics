

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>MitoEM segmentation &mdash; connectomics latest documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'latest',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="connectomics.model" href="../modules/model.html" />
    <link rel="prev" title="Synaptic Partner Segmentation" href="synaptic_partner.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo_text.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notes/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes/config.html">Configurations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../notes/config.html#basic-usage">Basic Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notes/config.html#multiple-losses-for-a-single-learning-target">Multiple Losses for a Single Learning Target</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notes/config.html#multitask-learning">Multitask Learning</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="snemi.html">Neuron Segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="lucchi.html">Mitochondria Segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="cremi.html">Synaptic Cleft Segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="synaptic_partner.html">Synaptic Partner Segmentation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">MitoEM segmentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Package Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/model.html">connectomics.model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../modules/model.html#building-blocks">Building Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../modules/model.html#model-zoo">Model Zoo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/augmentation.html">connectomics.data.augmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/datasets.html">connectomics.data.datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/engine.html">connectomics.engine</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">connectomics</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>MitoEM segmentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/mitoem.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mitoem-segmentation">
<h1>MitoEM segmentation<a class="headerlink" href="#mitoem-segmentation" title="Permalink to this headline">¶</a></h1>
<p>This tutorial provides step-by-step guidance for mitochondria segmentation with our benchmark datasets MitoEM.
We consider the task as 3D instance segmentation task and provide three different confiurations of the model output.
The model is ‘unet_res_3d’, similar to the one used in <a class="reference external" href="https://zudi-lin.github.io/pytorch_connectomics/build/html/tutorials/snemi.html">neuron segmentation</a>.
The evaluation of the segmentation results is based on the AP-75.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The MitoEM dataset has two sub-datasets <strong>rat</strong> and <strong>human</strong>. Three training scripts <code class="docutils literal"><span class="pre">.yaml</span></code> on <strong>rat</strong> are provided in
<code class="docutils literal"><span class="pre">pytorch_connectomics/configs/</span></code> for different outputs of the model.
The pytorch dataset class of synaptic partners is <code class="xref py py-class docutils literal"><span class="pre">connectomics.data.dataset.TileDataset</span></code>.</p>
</div>
<ol class="arabic">
<li><p class="first">Introduction to the dataset:</p>
<blockquote>
<div><p>Dataset can be found here</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>/n/pfister_lab2/Lab/vcg_connectomics/mitochondria/miccai2020/rat
</pre></div>
</div>
<p>or</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>/n/pfister_lab2/Lab/vcg_connectomics/mitochondria/miccai2020/human
</pre></div>
</div>
<p>Dataset description</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="xref py py-class docutils literal"><span class="pre">connectomics.data.dataset.TileDataset</span></code> only reads in part of the image files
correpoding to given coordinates when running.</p>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">im</span></code>: include 1000 2d <code class="docutils literal"><span class="pre">.png</span></code> (<strong>4096x4096</strong>) files of input images (resolution <strong>30x8x8</strong> nm)</li>
<li><code class="docutils literal"><span class="pre">mito</span></code>: include 1000 2d <code class="docutils literal"><span class="pre">.png</span></code> (<strong>4096x4096</strong>) files of instance labels</li>
<li><code class="docutils literal"><span class="pre">*.json</span></code>: <code class="xref py py-class docutils literal"><span class="pre">Dict</span></code> contain paths to <code class="docutils literal"><span class="pre">.png</span></code> files</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Configure <code class="docutils literal"><span class="pre">.yaml</span></code> file.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Change or add items in <code class="docutils literal"><span class="pre">.yaml</span></code> with keys in <code class="docutils literal"><span class="pre">connectomics/config/config.py</span></code></p>
<p class="last"><code class="docutils literal"><span class="pre">.yaml</span></code> files can be found in <code class="docutils literal"><span class="pre">pytorch_connectomics/configs/Mito-EM</span></code></p>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">MitoEM-R-A.yaml</span></code>: output 3 channels for affinty prediction</li>
<li><code class="docutils literal"><span class="pre">MitoEM-R-AB.yaml</span></code>: output 4 channels for both affinity and instance boundary prediction</li>
<li><code class="docutils literal"><span class="pre">MitoEM-R-bB.yaml</span></code>: output 2 channels for both binary and instance boundary prediction</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Run the training script.</p>
<blockquote>
<div><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default the path of images and labels are not specified. To
run the training scripts, please revise the <code class="docutils literal"><span class="pre">DATASET.IMAGE_NAME</span></code>, <code class="docutils literal"><span class="pre">DATASET.LABEL_NAME</span></code>, <code class="docutils literal"><span class="pre">DATASET.OUTPUT_PATH</span></code>
and <code class="docutils literal"><span class="pre">DATASET.INPUT_PATH</span></code> options in <code class="docutils literal"><span class="pre">configs/MitoEM-R_*.yaml</span></code>.
The options can also be given as command-line arguments without changing of the <code class="docutils literal"><span class="pre">yaml</span></code> configuration files.</p>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>$ source activate py3_torch
$ python -u scripts/main.py \
  --config-file configs/MitoEM-R_aff.yaml
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Visualize the training progress. More info <a class="reference external" href="https://vcg.github.io/newbie-wiki/build/html/computation/machine_rc.html">here</a>:</p>
<blockquote>
<div><div class="highlight-none"><div class="highlight"><pre><span></span>$ tensorboard --logdir ``OUTPUT_PATH/xxxxx``
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Tensorboard will create a subdir in OUTPUT_PATH. Substitute <strong>xxxxx</strong> with that subdir.</p>
</div>
</div></blockquote>
</li>
<li><p class="first">Run inference on image volumes:</p>
<blockquote>
<div><div class="highlight-none"><div class="highlight"><pre><span></span>$ source activate py3_torch
$ python -u scripts/main.py \
  --config-file configs/MitoEM-R_aff.yaml --inference \
  --checkpoint OUTPUT_PATH/xxxxx.pth.tar
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Please change the <code class="docutils literal"><span class="pre">INFERENCE.IMAGE_NAME</span></code> <code class="docutils literal"><span class="pre">INFERENCE.OUTPUT_PATH</span></code> <code class="docutils literal"><span class="pre">INFERENCE.OUTPUT_NAME</span></code>
options in <code class="docutils literal"><span class="pre">configs/MitoEM-R_aff.yaml</span></code>.</p>
</div>
</div></blockquote>
</li>
</ol>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../modules/model.html" class="btn btn-neutral float-right" title="connectomics.model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="synaptic_partner.html" class="btn btn-neutral float-left" title="Synaptic Partner Segmentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Zudi Lin and Donglai Wei

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>